<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | Smart Mind</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">

</head>

<body class="admin-body">
  <header>
    <a href="index.html" class="logo"><i class="fas fa-brain"></i> Smart Mind</a>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="subjects.html">Subjects</a></li>
        <li><a href="note.html">Notes</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
    <div class="auth-buttons">
      <button onclick="logout()">Logout</button>
    </div>
  </header>

  <div id="main-content">
    <section class="admin-container">
      <h2>Add New Note</h2>
      <form id="note-form" class="admin-form">
        <label for="title">Note Title:</label>
        <input type="text" id="title" placeholder="Enter note title" required>

        <label for="grade">Grade:</label>
        <select id="grade" required>
          <option value="">Select Grade</option>
          <option value="grade1">Grade 1</option>
          <option value="grade2">Grade 2</option>
          <option value="grade3">Grade 3</option>
          <option value="grade4">Grade 4</option>
          <option value="grade5">Grade 5</option>
          <option value="grade6">Grade 6</option>
          <option value="grade7">Grade 7</option>
          <option value="grade8">Grade 8</option>
        </select>

        <label for="subject">Subject:</label>
        <select id="subject" required>
          <option value="">Select Subject</option>
          <option value="mathematics">Mathematics</option>
          <option value="english">English</option>
          <option value="kiswahili">Kiswahili</option>
          <option value="integrated-science">Integrated Science</option>
          <option value="social-studies">Social Studies</option>
          <option value="cre">Christian Religious Education</option>
          <option value="pre-technical">Pre-Technical</option>
          <option value="agriculture-nutrition">Agriculture and Nutrition</option>
          <option value="creative-arts-sports">Creative Arts and Sports</option>
        </select>

        <label for="content">Note Content:</label>
        <textarea id="content" placeholder="Enter note content" rows="8" required></textarea>

        <label for="file">Upload File (Optional - Image or PDF):</label>
        <input type="file" id="file" accept=".png,.jpg,.jpeg,.gif,.pdf">

        <button type="submit">Add Note</button>
      </form>
    </section>
  </div>

  <footer class="footer">
    <div class="footer-container">
      <p>&copy; 2024 Smart Mind. All rights reserved.</p>
      <a href="#" class="footer-link">Privacy Policy</a>
      <a href="#" class="footer-link">Terms of Service</a>
    </div>
    <button class="footer-button" onclick="window.location.href='index.html'">Go to Home</button>
  </footer>

  <script src="script.js"></script>
  <script>
    // Firebase configuration (replace with your actual config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage(); // Initialize Firebase Storage

    // Supabase client (replace with your actual config)
    const SUPABASE_URL = 'YOUR_SUPABASE_URL';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
    const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Check authentication status
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = 'index.html'; // Redirect to login if not authenticated
      }
    });

    async function logout() {
      try {
        await auth.signOut();
        window.location.href = 'index.html'; // Redirect to home after logout
      } catch (error) {
        console.error("Error logging out:", error);
      }
    }

    // Handle form submission
    document.getElementById('note-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const title = document.getElementById('title').value;
      const grade = document.getElementById('grade').value;
      const subject = document.getElementById('subject').value;
      const content = document.getElementById('content').value;
      const fileInput = document.getElementById('file');
      const file = fileInput.files[0];

      let fileUrl = '';
      let fileType = '';

      if (file) {
        const storageRef = storage.ref();
        const fileRef = storageRef.child(`notes/${file.name}`);
        try {
          const snapshot = await fileRef.put(file);
          fileUrl = await snapshot.ref.getDownloadURL();
          fileType = file.type;
        } catch (error) {
          console.error("Error uploading file:", error);
          showMessage('Error uploading file!', 'error');
          return;
        }
      }

      try {
        await db.collection('notes').add({
          title: title,
          grade: grade,
          subject: subject,
          content: content,
          fileUrl: fileUrl,
          fileType: fileType,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showMessage('Note added successfully!', 'success');
        document.getElementById('note-form').reset();
      } catch (error) {
        console.error("Error adding note:", error);
        showMessage('Error adding note!', 'error');
      }
    });

    function showMessage(message, type) {
      const messageContainer = document.createElement('div');
      messageContainer.className = 'custom-message';
      messageContainer.textContent = message;

      if (type === 'success') {
        messageContainer.style.backgroundColor = '#4CAF50'; /* Green */
        messageContainer.style.color = '#fff';
      } else if (type === 'error') {
        messageContainer.style.backgroundColor = '#F44336'; /* Red */
        messageContainer.style.color = '#fff';
      } else {
        messageContainer.style.backgroundColor = '#2196F3'; /* Blue */
        messageContainer.style.color = '#fff';
      }

      document.body.appendChild(messageContainer);

      // Remove the message after a few seconds
      setTimeout(() => {
        messageContainer.remove();
      }, 5000); // Message visible for 5 seconds
    }
  </script>
</body>

</html>
